# A Solver Combination Ablation pipeline workflow

# This uses a separate script to download each URL, then calling the script with file handles instead

# Packages up an entire dir. This is to support transitive
# dependencies in scripts (scripts calling other scripts)
package {id:"aristoScripts", source:"solver-combo/aristo-scripts"}
package {id:"mathematicaScripts", source:"solver-combo/mathematica-scripts"}
package {id:"pythonScripts", source:"solver-combo/python-scripts"}



# Get feature vectors
{file:"GetFeatureVectorsFromEF.sh", package:"aristoScripts"} {output:"train1"} http://evaluation-framework.dev.allenai.org:8083/#/evaluation-sets/view/Regents%20Training%20and%20Regents%20Test%20and%20Monarch%20Training%20and%20Monarch%20Test/evaluation/b6d38f34-d08b-478c-af60-99c04b1b4d2d Train
{file:"GetFeatureVectorsFromEF.sh", package:"aristoScripts"} {output:"train2"} http://evaluation-framework.dev.allenai.org:8083/#/evaluation-sets/view/13b48240-1681-4911-908c-d3e7b00cf2dc/evaluation/f736cf66-5a20-4b52-970f-3db71737d95c Train
{file:"GetFeatureVectorsFromEF.sh", package:"aristoScripts"} {output:"test1"} http://evaluation-framework.dev.allenai.org:8083/#/evaluation-sets/view/Regents%20Training%20and%20Regents%20Test%20and%20Monarch%20Training%20and%20Monarch%20Test/evaluation/cdece2c1-32f4-4613-84d6-a92e4e73a1b9 Test
{file:"GetFeatureVectorsFromEF.sh", package:"aristoScripts"} {output:"test2"} http://evaluation-framework.dev.allenai.org:8083/#/evaluation-sets/view/13b48240-1681-4911-908c-d3e7b00cf2dc/evaluation/e24bd1ed-20fb-4dea-966e-df42b8dde121 Test
# Generate ablation data
{file:"SolverAblationStudy.sh", package:"aristoScripts"} -s Arizona,Inference,Lucene,Lucience,Salience -o {output:"ablationOutputDir", type:"dir", suffix:".zip"} --train1 {ref:"train1"} --train2 {ref:"train2"} --test1 {ref:"test1"} --test2 {ref:"test2"}
# Analyze ablation data
{file:"AblationStudyReport.m", package:"mathematicaScripts"} -i {ref:"ablationOutputDir"} -html {output:"ablationHTMLReport", suffix:".html"} -csv {output:"ablationCSVData", suffix:".csv"}
# Run Python analysis
#{file:"runiPythonNotebook.sh", package:"pythonScripts"} {input:"./solver-combo/python-scripts/testScript.ipynb"} {ref:"outputDir"} {output:"htmlReport", suffix:".html"}
{file:"runiPythonNotebook.sh", package:"pythonScripts"} {file:"testScript.ipynb", package:"pythonScripts"} {ref:"ablationOutputDir"} {output:"pythonHTMLNotebook", suffix:".html"}
